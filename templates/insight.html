<!DOCTYPE html>
<html lang="id">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <title>Insight Pemodelan Stroke</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
        <style>
            body {
                background: #f5f7fb;
            }
            .chart-card {
                border-radius: 28px;
                background: #fff;
                padding: 2rem;
                box-shadow: 0 25px 60px rgba(15, 23, 42, 0.12);
                height: 100%;
            }
            .matrix-wrapper {
                max-width: 560px;
                margin: 0 auto;
            }
            #cmPlot {
                width: 100%;
                height: 420px;
            }
        </style>
    </head>
    <body id="page-top">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
            <div class="container px-4">
                <a class="navbar-brand" href="/">Stroke Insight</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item"><a class="nav-link" href="/">Beranda</a></li>
                        <li class="nav-item"><a class="nav-link" href="/#prediksi">Prediksi</a></li>
                        <li class="nav-item"><a class="nav-link active" href="/insight">Insight Model</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <header class="hero text-white text-center" style="padding-top: 8rem;">
            <div class="container px-4">
                <h1 class="fw-bolder mb-3">Insight Pemodelan Stroke</h1>
                <p class="lead">Visualisasi ringkas hasil analisis dataset referensi dan bobot fitur model Random Forest.</p>
            </div>
        </header>

        <section>
            <div class="container px-4">
                <div class="row g-4">
                    <div class="col-lg-6">
                        <div class="chart-card">
                            <h4 class="fw-semibold mb-3">Distribusi Gender</h4>
                            <canvas id="genderChart"></canvas>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="chart-card">
                            <h4 class="fw-semibold mb-3">Proporsi Stroke</h4>
                            <canvas id="strokeChart"></canvas>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="chart-card">
                            <h4 class="fw-semibold mb-3">Tren Risiko per Kelompok Usia</h4>
                            <canvas id="ageChart"></canvas>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="chart-card">
                            <h4 class="fw-semibold mb-3">Fitur Paling Berpengaruh</h4>
                            <canvas id="featureChart"></canvas>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="chart-card">
                            <h4 class="fw-semibold mb-3">Confusion Matrix</h4>
                            <div class="matrix-wrapper">
                                <div id="cmPlot"></div>
                                <p class="text-muted mb-0 mt-3">
                                    Heatmap interaktif: arahkan kursor untuk melihat nilai tiap sel (TN, FP, FN, TP).
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <footer>
            <div class="container px-4">
                <p class="m-0 text-center">Data bersumber dari healthcare-dataset-stroke-data.csv</p>
            </div>
        </footer>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
        <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
        <script>
            const genderCounts = {{ gender_counts | tojson }};
            const strokeCounts = {{ stroke_counts | tojson }};
            const strokeRateByAge = {{ stroke_rate_by_age | tojson }};
            const featureImportance = {{ feature_importance | tojson }};
            const cm = {{ confusion_matrix | tojson }};

            const palette = ['#2563eb', '#1d4ed8', '#3b82f6', '#60a5fa', '#a855f7', '#06b6d4'];

            new Chart(document.getElementById('genderChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(genderCounts),
                    datasets: [{
                        data: Object.values(genderCounts),
                        backgroundColor: palette,
                    }]
                },
                options: { plugins: { legend: { position: 'bottom' } } }
            });

            new Chart(document.getElementById('strokeChart'), {
                type: 'pie',
                data: {
                    labels: Object.keys(strokeCounts),
                    datasets: [{
                        data: Object.values(strokeCounts),
                        backgroundColor: ['#22c55e', '#ef4444'],
                    }]
                },
                options: { plugins: { legend: { position: 'bottom' } } }
            });

            new Chart(document.getElementById('ageChart'), {
                type: 'line',
                data: {
                    labels: Object.keys(strokeRateByAge),
                    datasets: [{
                        label: 'Persentase Stroke (%)',
                        data: Object.values(strokeRateByAge),
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37,99,235,0.15)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.35,
                    }]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true, ticks: { callback: (v) => v + '%' } }
                    }
                }
            });

            new Chart(document.getElementById('featureChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(featureImportance),
                    datasets: [{
                        label: 'Feature Importance',
                        data: Object.values(featureImportance),
                        backgroundColor: '#f97316',
                    }]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });

            const cmMatrix = [
                [cm.tn, cm.fp],
                [cm.fn, cm.tp],
            ];

            const cmHeatmap = [{
                z: cmMatrix,
                x: ['0', '1'],
                y: ['0', '1'],
                type: 'heatmap',
                colorscale: 'Blues',
                hovertemplate: 'Aktual %{y}, Prediksi %{x}<br>Nilai: %{z}<extra></extra>',
                showscale: true,
                colorbar: {
                    title: { text: 'Frekuensi', side: 'right' }
                }
            }];

            const annotations = [];
            cmMatrix.forEach((row, i) => {
                row.forEach((value, j) => {
                    annotations.push({
                        x: ['0', '1'][j],
                        y: ['0', '1'][i],
                        text: value,
                        font: { color: value > (cm.tn + cm.tp) / 4 ? '#ffffff' : '#0f172a', size: 16, family: 'Inter, sans-serif' },
                        showarrow: false
                    });
                });
            });

            const cmLayout = {
                title: { text: 'Confusion Matrix', font: { family: 'Inter, sans-serif', size: 20 } },
                xaxis: { title: 'Prediksi' },
                yaxis: { title: 'Aktual', autorange: 'reversed' },
                margin: { l: 70, r: 70, t: 70, b: 70 },
                paper_bgcolor: 'transparent',
                plot_bgcolor: 'transparent',
                annotations
            };

            Plotly.newPlot('cmPlot', cmHeatmap, cmLayout, { responsive: true });

        </script>
    </body>
</html>

